# Context Free Grammars: Derivation Trees and Ambiguity

# Inductive Definitions

Inductive definitions define the smallest set satisfying some conditions:

- $AnBn = \{ a^n b^n \ | \ n \in \mathbb{N} \}$
  - $\Lambda \in AnBn$
  - If $w \in AnBn$, then $awb \in AnBn$
- $Pal = \{ w \in \{a, b\}^* \ | \ w = w^r \}$
  - $\Lambda, a, b \in Pal$
  - If $w \in Pal$, $awa \in Pal$ and $bwb \in Pal$

# Examples of Grammar

- Alphabet: $\{1, 2, 3, +, \times\}$
- Variables: $\{S, T\}$
- Expression: $1 + 2 \times 3$

Let us specify the language of all correct expressions

$$
G_3 = \begin{cases}
S \rightarrow T + S \ | \ T \\
T \rightarrow 1 \ | \ 2 \ | \ 3 \ | \ T \times T
\end{cases}
$$

# Context-Free Grammar

Context-Free Grammar (CFG) is a 4-tuple: $\langle V, \Sigma, P, S \rangle$:

- $V$ is a finite set of variables
- $\Sigma$ is a finite set of alphabet which is disjunct with $V$ ($V \cap \Sigma = \empty$)
- $P \subseteq V \times (V \cup \Sigma)^*$ is a finite set of rules (aka productions)
- $S \in V$ is the start symbol

Note:

- A rule is a pair $(A, w)$ with $A \in V$ and $w \in (V \cup \Sigma)^*$
  - If $(A, w_1), (A, w_2), ... \in P$, then $A \rightarrow w_1 \ | \ w_2 \ | \ ...$
  - Note that $(A, \Lambda) \in P$
- Covention:
  - Variables are usually capitalised ($A, B, C, ...$)
  - Alphabets are usually lower-case ($a, b, c, ...$)

For example:

- $V = \{S, A \}$, $\Sigma = \{a, b \}$
  - $S \rightarrow AA$
  - $A \rightarrow AAA \ | \ bA \ | \ Ab \ | \ a$

## Derivability

When a string $y$ can be derived from a string $x$, we write $x \implies y$

- $x \implies y$ iff $x = uAv$ and $y = uwv$ for some rule $A \rightarrow w \in P$

Take a CFG $\langle V, \Sigma, P, S \rangle$ and a string $v = (V \cup \Sigma)^*$. The set of derivable strings $Der(v)$ is the smallest set such that

- $v \in Der(v)$
- If $u \in Der(v)$ and $u \implies w$, then $w \in Der(v)$

Note that

- $v \stackrel{*}{\implies} w$: "w is derivable from v"
- $v \stackrel{n}{\implies} w$: "w is derivable from v in $n$ steps"

## Sentential Forms, Sentences, and Languages

The language of a CFG:

Given a CFG $G = \langle V, \Sigma, P, S \rangle$:

- If $S \stackrel{*}{\implies} w$ then $w$ is called a sentential form
- If additionally, $w \in \Sigma^*$, then $w$ is a sentence
- The language of $G$ is defined as the set of all sentences: $\mathcal{L}(G) = \{ w \in \Sigma^* \ | \ S \stackrel{*}{\implies} w \}$

A set of words $X \subseteq \Sigma^*$ is a context-free language if and only if there exists a CFG $G$ such that $\mathcal{L}(G) = X$

We sometimes call these languages context-free languages (CFL)

## Context-Free Languages that were not regular

1. A number of $a$'s followed by the same number of $b$'s

   $L = \{ a^n b^n \ | \ n \in \mathbb{N} \}$

   $S \rightarrow a S b \ | \ \Lambda$

2. Palindromes over $a, b$

   $L =  \{ w \in {a, b}^âˆ— \ | \ w = w^r \}$

   $S \rightarrow aSa \ | \ bSb \ | \ a \ | \ b \ | \ \Lambda$

# Regular Grammars

A grammar is regular if every rule has on of the following forms (with $A, B \in V$ and $a \in \Sigma$):

- $A \rightarrow a$
- $A \rightarrow aB$
- $a \rightarrow \Lambda$

- Are all regular languages context-free?
- Are all context-free languages regular?
- If we have 2 CFGs $G_1$ and $G_2$, $G_1 \equiv G_2 \iff \mathcal{L}(G_1) = \mathcal{L}(G_2)$. How do we check the equivalence of 2 CFGs?
- Are all languages context-free?

## Finite Automata to Regular Grammar

Given an NFA $M = (Q, \Sigma, q_0, F, \delta)$, we define $G = (Q, \Sigma, P, q_0)$ with

- For all $q \in Q$ and $q' \in \delta(q, a)$, we add $(q \rightarrow aq') \in P$
- For all $q \in F$, add $(q \rightarrow \Lambda) \in P$

Then $\mathcal{L}(G) = \mathcal{L}(M)$

Intuition behind the conversion

- Every state in the NFA becomes a variable in the CFG
- Every transition $q \stackrel{a}{\rightarrow} q'$ becomes a rule $q \rightarrow aq'$
- Every accepting state $q$ becomes a rule $q \rightarrow \Lambda$
- Paths in the automaton correspond to the derivations

## Regular Grammar to Finite Automata

Given a CFG $G = (V, \Sigma, P, S)$, we define $M = (V \cup \{Z\}, \Sigma, S, F, \delta)$

- $Z$ is a new special variable not in $V$
- $B \in \delta(A, a)$ for all $A \rightarrow aB$
- $Z = \delta(A, a)$ for all $A \rightarrow a$
- $A \in F$ (final states) for all $A \rightarrow \Lambda$, and $Z \in F$

Then, $\mathcal{L}(M) = \mathcal{L}(G)$

Intuition behind the conversion

- Every variable of the grammar becomes a state
- Special accepting state $Z$ for terminal rules
- Rules $A \rightarrow aB$ become transitions $A \stackrel{a}{\rightarrow} B$
- Rules $A \rightarrow a$ become transitions $A \stackrel{a}{\rightarrow} Z$ (with $Z \in F$)
- Rules $A \rightarrow \Lambda$ result in $A \in F$

# Derivation Trees

![Derivation tree](https://www.gatevidyalay.com/wp-content/uploads/2018/08/Example-of-Leftmost-Derivation-Tree.png)

Take a CFG $G = (V, \Sigma, P, S)$ and a derivation $S \stackrel{*}{\implies} w$

The ordered derivation tree of $S \stackrel{*}{\implies} w$ is constructed as follows:

- Internal nodes are labelled in $V$, leaves are labelled in $\Sigma \cup \{\Lambda\}$
- Create a root node labelled $S$
- For a node labelled $A$, corresponding to an application of the rule $A \rightarrow x_1, ..., x_n$ (with all $x_i \in V \cup \Sigma$) in $S \stackrel{*}{\implies} w$:
  - Create its $n$ children and label them $x_1, ... x_n$
- At the application of the rule $A \rightarrow \Lambda$, add $\Lambda$ as its only child of $A$

At any time during the construction, the derived word is equal to the symbols of the leaves, in the order of the tree

# Ambiguity

A CFG $G$ is **ambiguous** if there is a word $w \in \mathcal{L}(G)$ with at least **two different derivation trees**

Note

- Ambiguity is a property of grammars, not of languages
- A language can have both ambiguous and unambiguous grammar

  $$
  \begin{aligned}
  G_1 &: S \rightarrow aS \ | \ Sa \ | \ a \\
  G_2 &: S \rightarrow aS \ | \ a
  \end{aligned}
  $$

  $\mathcal{L}(G_1) = \mathcal{L}(G_2) = a^+$ holds, but $G_1$ is ambiguous, and $G_2$ is not

- There are languages that only have ambiguous grammars. For example: $L = \{a^m b^m c^n \ | \ m,n \geq 0\} \cup \{a^m b^n c^n \ | \ m,n \geq 0\}$
- For regular languages, there always exists unambiguous grammars
- Programming languages should have unambiguous grammars

## Ambiguity in Natural and Programming Languages

I saw a man on a hill with a telescope

- I saw (a man on a hill) with a telescope
- I saw (a man (on a hill) with a telescope)
- I saw (a man (on a hill with a telescope))

# Verification of Grammar

For some CFG $G$ and some language $X \subseteq \Sigma^*$, is $\mathcal{L}(G) = X$?

To prove that $\mathcal{L}(G) = X$:

1. Prove $X \subseteq \mathcal{L}(G)$
   - For all $w$, $w \in X \implies w \in \mathcal{L}(G)$
   - Prove that $\forall w \in X, S \stackrel{*}{\implies} w$
   - This is shown by constructing every word $w \in X$ using rules from $G$
2. Prove $\mathcal{L}(G) \subseteq X$
   - For all $w$, $w \in \mathcal{L}(G) \implies w \in X$
   - $\forall w \in \mathcal{L}(G), (S \stackrel{*}{\implies} w) \implies (w \in X)$
   - Proof by induction on length $n$
     - Assume $S \stackrel{0}{\implies} w$, and show that $w \in X$
     - Induction hypothesis: Assume that $S \stackrel{k}{\implies} w$ then $w \in X$
     - Show that $S \stackrel{k+1}{\implies} w$ then $w \in X$
       - From the induction hypothesis, $S \stackrel{k}{\implies} v, v \in X$
       - $S \stackrel{k}{\implies} v \implies w$
       - Prove that $w \in X$ using $v \implies w$ and rules from $G$

Both parts done with induction
