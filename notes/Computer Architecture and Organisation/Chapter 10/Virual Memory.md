# Virtual Memory

Each memory has a different way to store memory, and there must be a way to interface between multiple devices and still get the correct data.

- When executing a program, the information required is obtained by issuing a request to the operating system (OS) using the address assigned by the compiler
- The program does not need to know how the required information is organised in the system memory. It relies on a middleman to do the corresponding address translation in order to fetch the correct information
- In this case, the OS acts as a middleman and translates the compiler generated address to the system memory address where the required information is stored
- Program will work as long as it gets the code/data requested

# Virtual Memory Management
- Each program has its own virtual address space
- The actual program code and data are stored in the system and storage memory, which has their own addressing space
- Address translation is done by the OS
- A subset of the program is available in the system memory during runtime
- The complete program is available in the storage memory can be transferred to the system memory when required

# Virtual vs Physical Memory Address Space
- The addresses used by the program is generated by the compiler and is known as a **virtual address**
- The virtual address of the code/data is usually different from the physical memory address that they reside in
- Address translation is required and is done in hardware and/or software managed by the OS

## Advantage of Virtual Memory
- OS able to isolate each virtual memory space and prevent corruption between these spaces
- Allow efficient and safe sharing among different programs within the shared physical memory
- Allow one or more programs to run in the physical memory simultaneously even if the total size of all the programs is larger than actual physical memory size
- OS is able to relocate virtual memory blocks to any physical memory blocks. This allows the virtual address space seen by the application to appear to be contiguous when its actually fragmented

# Address Mapping
- There are 2 common schemes used in the industry for address mapping
  - Paging - Memory space partitioned into fixed sized blocks
  - Segmentation - memory space partitioned into variable sized segments

## Paging
- In a system that uses paging, the memory space is partitioned into fixed sized blocks known as a page/frame
- Information concerning the location of each page, whether on disk or in memory is maintained in a data structure called a **page table**
- In a page table
  - Frame refers to the physical frame number in main memory
  - Page refers to the virtual page number used by program code
  - Valid bit indicates whether the virtual page is in the main memory (VB=1) or not (VB=0)

# Translation Lookaside Buffer (TLB)
- Page table is located in main memory, so access is relatively slower than internal memory access
- To speed up page translation process, a page table cache is used to store a list of the most recently/frequently used address translation entries in the page table
- TLB is implemented with fast memory such as SRAM and reside within the processor
- Each TLB entry includes a virtual page number and its corresponding frame number

# TLB Lookup Process

1. From the virtual address, the OS looks up the TLB
2. If the virtual address resides in the TLB, it is a TLB Hit, and it gets translated into a physical address to be fetched from the main memory
3. If the virtual address does not reside in the TLB, it is a TLB Miss, and a similar process occurs
4. If an entry is still not found (Data not in physical memory), it is a page fault. Memory is fetched from the secondary memory, and the data is loaded into physical memory first, and page table is updated